stages: [build, test, package, deploy]

build:
  stage: build
  image: python:3.11
  script:
    - echo "Build stage running"
    - if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
  artifacts:
    paths:
      - .venv/

test:
  stage: test
  image: python:3.11
  script:
    - pip install pytest pytest-cov
    - pytest tests || true
  artifacts:
    paths:
      - reports/

package:
  stage: package
  image: python:3.11
  script:
    - pip install build twine
    - python -m build
    - twine check dist/*
  artifacts:
    paths:
      - dist/

deploy:
  stage: deploy
  image: python:3.11
  needs: ["package"]
  script:
    - pip install twine
    - twine check dist/*
    - echo "Deploy stage finished successfully"
  artifacts:
    paths:
      - dist/
